--1 How many unique nodes are there on the Data Bank system?

SELECT COUNT(DISTINCT node_id) from data_bank.customer_nodes;

-- 2What is the number of nodes per region?

SELECT region_id , COUNT( node_id) AS num_nodes_per_region
from data_bank.customer_nodes
GROUP BY region_id ORDER BY region_id;

--3 How many customers are allocated to each region?

SELECT region_id, COUNT(DISTINCT customer_id) AS customers_allocated
from data_bank.customer_nodes
GROUP BY region_id ORDER BY region_id;


--4 How many days on average are customers reallocated to a different node?
select avg(end_date- start_date)
from data_bank.customer_nodes;
--aşağıdaki aşırı alkasz detaylı bişey oldu.
SELECT customer_id, region_id,node_id,AVG (end_date - start_date) OVER( PARTITION BY customer_id order by node_id )
from data_bank.customer_nodes
;

SELECT customer_id,node_id, AVG(end_date- start_date)
from data_bank.customer_nodes
group by customer_id,node_id
ORDER BY customer_id;


--5 What is the median, 80th and 95th percentile for this same reallocation days metric for each region?
-B. Customer Transactions
--1 What is the unique count and total amount for each transaction type?ion type?

SELECT 
	txn_type,
	COUNT(txn_type) AS unique_count,
	SUM(txn_amount) AS total_amount
FROM data_bank.customer_transactions
GROUP BY txn_type;
--2 
What is the average total historical deposit counts and amounts for all customers?

